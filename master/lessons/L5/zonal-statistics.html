

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-88382509-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Zonal statistics &mdash; Intro to Python GIS CSC documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/banner.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="prev" title="Creating a raster mosaic" href="../../notebooks/L5/raster-mosaic.html" />
    <link href="../../_static/geo-python.css" rel="stylesheet" type="text/css">
     


  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Intro to Python GIS
          

          
            
            <img src="../../_static/logo_small.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2018
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Course information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/course-info.html">General info</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/who-are-you.html">Who are you?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/Installing_Anacondas_GIS.html">Installing Python + GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../course-info/License-terms.html">License and terms of usage</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../L1/overview.html">Lesson overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/L1/geometric-objects.html">Geometric objects - Spatial data model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L1/ex-1.html">Exercise 1</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../L2/overview.html">Lesson 2 Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/L2/geopandas-basics.html">Introduction to Geopandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/L2/projections.html">Map projections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/L2/data_io.html">Vector Data I/O from various formats / sources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L2/ex-2.html">Exercise 2</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 3</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../L3/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/L3/Geocoding_in_Geopandas.html">Geocoding in Geopandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/L3/reclassify.html">Data reclassification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L3/ex-3.html">Exercise 3</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 4</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../L4/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/L4/spatial-join.html">Spatial join</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/L4/nearest-neighbour.html">Nearest Neighbour Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../L4/ex-4.html">Exercise 4</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 5</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="download-data.html">Automatize data download</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/L5/reading-raster.html">Reading raster files with Rasterio</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/L5/plotting-raster.html">Visualizing raster layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/L5/clipping-raster.html">Masking / clipping raster</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/L5/raster-map-algebra.html">Raster map algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../notebooks/L5/raster-mosaic.html">Creating a raster mosaic</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Zonal statistics</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Intro to Python GIS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
      <li>Zonal statistics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/Automating-GIS-processes/CSC/blob/master/source/lessons/L5/zonal-statistics.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  






<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="zonal-statistics">
<h1>Zonal statistics<a class="headerlink" href="#zonal-statistics" title="Permalink to this headline">¶</a></h1>
<p>Quite often you have a situtation when you want to summarize raster datasets based on vector geometries.
<a class="reference external" href="https://github.com/perrygeo/python-rasterstats">Rasterstats</a> is a Python module that does exactly that, easily.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">rasterio</span>

<span class="gp">In [2]: </span><span class="kn">from</span> <span class="nn">rasterio.plot</span> <span class="kn">import</span> <span class="n">show</span>

<span class="gp">In [3]: </span><span class="kn">from</span> <span class="nn">rasterstats</span> <span class="kn">import</span> <span class="n">zonal_stats</span>

<span class="gp">In [4]: </span><span class="kn">import</span> <span class="nn">osmnx</span> <span class="kn">as</span> <span class="nn">ox</span>

<span class="gp">In [5]: </span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="kn">as</span> <span class="nn">gpd</span>
</pre></div>
</div>
<ul class="simple">
<li>Specify filepath, this is the mosaic raster file that was created earlier.</li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">dem_fp</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\HY-DATA\HENTENKA\KOODIT\Opetus\Automating-GIS-processes\Data\CSC_Lesson6\Helsinki_DEM_2x2m_Mosaic.tif&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li>Read in the DEM data</li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">dem</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dem_fp</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">CPLE_OpenFailedError</span><span class="g g-Whitespace">                      </span>Traceback (most recent call last)
<span class="nn">rasterio/_base.pyx</span> in <span class="ni">rasterio._base.DatasetBase.__init__</span><span class="nt">()</span>

<span class="nn">rasterio/_shim.pyx</span> in <span class="ni">rasterio._shim.open_dataset</span><span class="nt">()</span>

<span class="nn">rasterio/_err.pyx</span> in <span class="ni">rasterio._err.exc_wrap_pointer</span><span class="nt">()</span>

<span class="ne">CPLE_OpenFailedError</span>: C:\HY-DATA\HENTENKA\KOODIT\Opetus\Automating-GIS-processes\Data\CSC_Lesson6\Helsinki_DEM_2x2m_Mosaic.tif: No such file or directory

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">RasterioIOError</span><span class="g g-Whitespace">                           </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-7-5333fb6d73a2&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">dem</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dem_fp</span><span class="p">)</span>

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/rasterio/env.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">400</span> 
<span class="g g-Whitespace">    </span><span class="mi">401</span>         <span class="k">with</span> <span class="n">env_ctor</span><span class="p">(</span><span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">402</span>             <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">403</span> 
<span class="g g-Whitespace">    </span><span class="mi">404</span>     <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/rasterio/__init__.py</span> in <span class="ni">open</span><span class="nt">(fp, mode, driver, width, height, count, crs, transform, dtype, nodata, sharing, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span>         <span class="c1"># None.</span>
<span class="g g-Whitespace">    </span><span class="mi">216</span>         <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">217</span>             <span class="n">s</span> <span class="o">=</span> <span class="n">DatasetReader</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">218</span>         <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;r+&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">219</span>             <span class="n">s</span> <span class="o">=</span> <span class="n">get_writer_for_path</span><span class="p">(</span><span class="n">path</span><span class="p">)(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="n">driver</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">rasterio/_base.pyx</span> in <span class="ni">rasterio._base.DatasetBase.__init__</span><span class="nt">()</span>

<span class="ne">RasterioIOError</span>: C:\HY-DATA\HENTENKA\KOODIT\Opetus\Automating-GIS-processes\Data\CSC_Lesson6\Helsinki_DEM_2x2m_Mosaic.tif: No such file or directory
</pre></div>
</div>
<ul class="simple">
<li>Specify place names for Kallio and Pihlajamäki that Nominatim can identify <a class="reference external" href="https://nominatim.openstreetmap.org/">https://nominatim.openstreetmap.org/</a></li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="n">kallio_q</span> <span class="o">=</span> <span class="s2">&quot;Kallio, Helsinki, Finland&quot;</span>

<span class="gp">In [9]: </span><span class="n">pihlajamaki_q</span> <span class="o">=</span> <span class="s2">&quot;Pihlajamäki, Malmi, Helsinki, Finland&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li>Retrieve ‘Kallio’ and ‘Pihlajamäki’ regions from OpenStreetMap</li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">kallio</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">gdf_from_place</span><span class="p">(</span><span class="n">kallio_q</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">WantReadError</span><span class="g g-Whitespace">                             </span>Traceback (most recent call last)
<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/contrib/pyopenssl.py</span> in <span class="ni">wrap_socket</span><span class="nt">(self, sock, server_side, do_handshake_on_connect, suppress_ragged_eofs, server_hostname)</span>
<span class="g g-Whitespace">    </span><span class="mi">443</span>             <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">444</span>                 <span class="n">cnx</span><span class="o">.</span><span class="n">do_handshake</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">445</span>             <span class="k">except</span> <span class="n">OpenSSL</span><span class="o">.</span><span class="n">SSL</span><span class="o">.</span><span class="n">WantReadError</span><span class="p">:</span>

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/OpenSSL/SSL.py</span> in <span class="ni">do_handshake</span><span class="nt">(self)</span>
<span class="g g-Whitespace">   </span><span class="mi">1906</span>         <span class="n">result</span> <span class="o">=</span> <span class="n">_lib</span><span class="o">.</span><span class="n">SSL_do_handshake</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ssl</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1907</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_raise_ssl_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ssl</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1908</span> 

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/OpenSSL/SSL.py</span> in <span class="ni">_raise_ssl_error</span><span class="nt">(self, ssl, result)</span>
<span class="g g-Whitespace">   </span><span class="mi">1613</span>         <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="n">_lib</span><span class="o">.</span><span class="n">SSL_ERROR_WANT_READ</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1614</span>             <span class="k">raise</span> <span class="n">WantReadError</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1615</span>         <span class="k">elif</span> <span class="n">error</span> <span class="o">==</span> <span class="n">_lib</span><span class="o">.</span><span class="n">SSL_ERROR_WANT_WRITE</span><span class="p">:</span>

<span class="ne">WantReadError</span>: 

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">timeout</span><span class="g g-Whitespace">                                   </span>Traceback (most recent call last)
<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connectionpool.py</span> in <span class="ni">_make_request</span><span class="nt">(self, conn, method, url, timeout, chunked, **httplib_request_kw)</span>
<span class="g g-Whitespace">    </span><span class="mi">342</span>         <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">343</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_validate_conn</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">344</span>         <span class="k">except</span> <span class="p">(</span><span class="n">SocketTimeout</span><span class="p">,</span> <span class="n">BaseSSLError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connectionpool.py</span> in <span class="ni">_validate_conn</span><span class="nt">(self, conn)</span>
<span class="g g-Whitespace">    </span><span class="mi">848</span>         <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="s1">&#39;sock&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>  <span class="c1"># AppEngine might not have  `.sock`</span>
<span class="ne">--&gt; </span><span class="mi">849</span>             <span class="n">conn</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">850</span> 

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connection.py</span> in <span class="ni">connect</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">355</span>             <span class="n">server_hostname</span><span class="o">=</span><span class="n">hostname</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">356</span>             <span class="n">ssl_context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">357</span> 

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/util/ssl_.py</span> in <span class="ni">ssl_wrap_socket</span><span class="nt">(sock, keyfile, certfile, cert_reqs, ca_certs, server_hostname, ssl_version, ciphers, ssl_context, ca_cert_dir)</span>
<span class="g g-Whitespace">    </span><span class="mi">358</span>         <span class="k">if</span> <span class="n">HAS_SNI</span> <span class="ow">and</span> <span class="n">server_hostname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">359</span>             <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">server_hostname</span><span class="o">=</span><span class="n">server_hostname</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span> 

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/contrib/pyopenssl.py</span> in <span class="ni">wrap_socket</span><span class="nt">(self, sock, server_side, do_handshake_on_connect, suppress_ragged_eofs, server_hostname)</span>
<span class="g g-Whitespace">    </span><span class="mi">446</span>                 <span class="k">if</span> <span class="ow">not</span> <span class="n">util</span><span class="o">.</span><span class="n">wait_for_read</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">sock</span><span class="o">.</span><span class="n">gettimeout</span><span class="p">()):</span>
<span class="ne">--&gt; </span><span class="mi">447</span>                     <span class="k">raise</span> <span class="n">timeout</span><span class="p">(</span><span class="s1">&#39;select timed out&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">448</span>                 <span class="k">continue</span>

<span class="ne">timeout</span>: select timed out

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">ReadTimeoutError</span><span class="g g-Whitespace">                          </span>Traceback (most recent call last)
<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/requests/adapters.py</span> in <span class="ni">send</span><span class="nt">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="g g-Whitespace">    </span><span class="mi">444</span>                     <span class="n">retries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">445</span>                     <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span>
<span class="g g-Whitespace">    </span><span class="mi">446</span>                 <span class="p">)</span>

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connectionpool.py</span> in <span class="ni">urlopen</span><span class="nt">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, **response_kw)</span>
<span class="g g-Whitespace">    </span><span class="mi">637</span>             <span class="n">retries</span> <span class="o">=</span> <span class="n">retries</span><span class="o">.</span><span class="n">increment</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">_pool</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">638</span>                                         <span class="n">_stacktrace</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>
<span class="g g-Whitespace">    </span><span class="mi">639</span>             <span class="n">retries</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/util/retry.py</span> in <span class="ni">increment</span><span class="nt">(self, method, url, response, error, _pool, _stacktrace)</span>
<span class="g g-Whitespace">    </span><span class="mi">366</span>             <span class="k">if</span> <span class="n">read</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_method_retryable</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">367</span>                 <span class="k">raise</span> <span class="n">six</span><span class="o">.</span><span class="n">reraise</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">error</span><span class="p">),</span> <span class="n">error</span><span class="p">,</span> <span class="n">_stacktrace</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">368</span>             <span class="k">elif</span> <span class="n">read</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/packages/six.py</span> in <span class="ni">reraise</span><span class="nt">(tp, value, tb)</span>
<span class="g g-Whitespace">    </span><span class="mi">685</span>             <span class="k">raise</span> <span class="n">value</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">tb</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">686</span>         <span class="k">raise</span> <span class="n">value</span>
<span class="g g-Whitespace">    </span><span class="mi">687</span> 

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connectionpool.py</span> in <span class="ni">urlopen</span><span class="nt">(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, **response_kw)</span>
<span class="g g-Whitespace">    </span><span class="mi">599</span>                                                   <span class="n">body</span><span class="o">=</span><span class="n">body</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">600</span>                                                   <span class="n">chunked</span><span class="o">=</span><span class="n">chunked</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">601</span> 

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connectionpool.py</span> in <span class="ni">_make_request</span><span class="nt">(self, conn, method, url, timeout, chunked, **httplib_request_kw)</span>
<span class="g g-Whitespace">    </span><span class="mi">345</span>             <span class="c1"># Py2 raises this as a BaseSSLError, Py3 raises it as socket timeout.</span>
<span class="ne">--&gt; </span><span class="mi">346</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_raise_timeout</span><span class="p">(</span><span class="n">err</span><span class="o">=</span><span class="n">e</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout_value</span><span class="o">=</span><span class="n">conn</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">347</span>             <span class="k">raise</span>

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connectionpool.py</span> in <span class="ni">_raise_timeout</span><span class="nt">(self, err, url, timeout_value)</span>
<span class="g g-Whitespace">    </span><span class="mi">305</span>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">SocketTimeout</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">306</span>             <span class="k">raise</span> <span class="n">ReadTimeoutError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s2">&quot;Read timed out. (read timeout=</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">timeout_value</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">307</span> 

<span class="ne">ReadTimeoutError</span>: HTTPSConnectionPool(host=&#39;nominatim.openstreetmap.org&#39;, port=443): Read timed out. (read timeout=30)

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">ReadTimeout</span><span class="g g-Whitespace">                               </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-10-f94d43bd0b96&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">kallio</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">gdf_from_place</span><span class="p">(</span><span class="n">kallio_q</span><span class="p">)</span>

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/osmnx/core.py</span> in <span class="ni">gdf_from_place</span><span class="nt">(query, gdf_name, which_result, buffer_dist)</span>
<span class="g g-Whitespace">    </span><span class="mi">436</span> 
<span class="g g-Whitespace">    </span><span class="mi">437</span>     <span class="c1"># get the data from OSM</span>
<span class="ne">--&gt; </span><span class="mi">438</span>     <span class="n">data</span> <span class="o">=</span> <span class="n">osm_polygon_download</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">which_result</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">439</span>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">which_result</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">440</span> 

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/osmnx/core.py</span> in <span class="ni">osm_polygon_download</span><span class="nt">(query, limit, polygon_geojson)</span>
<span class="g g-Whitespace">    </span><span class="mi">404</span> 
<span class="g g-Whitespace">    </span><span class="mi">405</span>     <span class="c1"># request the URL, return the JSON</span>
<span class="ne">--&gt; </span><span class="mi">406</span>     <span class="n">response_json</span> <span class="o">=</span> <span class="n">nominatim_request</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">407</span>     <span class="k">return</span> <span class="n">response_json</span>
<span class="g g-Whitespace">    </span><span class="mi">408</span> 

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/osmnx/core.py</span> in <span class="ni">nominatim_request</span><span class="nt">(params, pause_duration, timeout, error_pause_duration)</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span>         <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span>         <span class="n">log</span><span class="p">(</span><span class="s1">&#39;Requesting {} with timeout={}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">prepared_url</span><span class="p">,</span> <span class="n">timeout</span><span class="p">))</span>
<span class="ne">--&gt; </span><span class="mi">262</span>         <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">get_http_headers</span><span class="p">())</span>
<span class="g g-Whitespace">    </span><span class="mi">263</span> 
<span class="g g-Whitespace">    </span><span class="mi">264</span>         <span class="c1"># get the response size and the domain, log result</span>

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/requests/api.py</span> in <span class="ni">get</span><span class="nt">(url, params, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span> 
<span class="g g-Whitespace">     </span><span class="mi">71</span>     <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;allow_redirects&#39;</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">72</span>     <span class="k">return</span> <span class="n">request</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">73</span> 
<span class="g g-Whitespace">     </span><span class="mi">74</span> 

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/requests/api.py</span> in <span class="ni">request</span><span class="nt">(method, url, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span>     <span class="c1"># cases, and look like a memory leak in others.</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span>     <span class="k">with</span> <span class="n">sessions</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">58</span>         <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span> 
<span class="g g-Whitespace">     </span><span class="mi">60</span> 

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/requests/sessions.py</span> in <span class="ni">request</span><span class="nt">(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)</span>
<span class="g g-Whitespace">    </span><span class="mi">510</span>         <span class="p">}</span>
<span class="g g-Whitespace">    </span><span class="mi">511</span>         <span class="n">send_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">512</span>         <span class="n">resp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">prep</span><span class="p">,</span> <span class="o">**</span><span class="n">send_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">513</span> 
<span class="g g-Whitespace">    </span><span class="mi">514</span>         <span class="k">return</span> <span class="n">resp</span>

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/requests/sessions.py</span> in <span class="ni">send</span><span class="nt">(self, request, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">620</span> 
<span class="g g-Whitespace">    </span><span class="mi">621</span>         <span class="c1"># Send the request</span>
<span class="ne">--&gt; </span><span class="mi">622</span>         <span class="n">r</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">623</span> 
<span class="g g-Whitespace">    </span><span class="mi">624</span>         <span class="c1"># Total elapsed time of the request (approximately)</span>

<span class="nn">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/requests/adapters.py</span> in <span class="ni">send</span><span class="nt">(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="g g-Whitespace">    </span><span class="mi">524</span>                 <span class="k">raise</span> <span class="n">SSLError</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">525</span>             <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">ReadTimeoutError</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">526</span>                 <span class="k">raise</span> <span class="n">ReadTimeout</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">527</span>             <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">528</span>                 <span class="k">raise</span>

<span class="ne">ReadTimeout</span>: HTTPSConnectionPool(host=&#39;nominatim.openstreetmap.org&#39;, port=443): Read timed out. (read timeout=30)

<span class="gp">In [11]: </span><span class="n">pihlajamaki</span> <span class="o">=</span> <span class="n">ox</span><span class="o">.</span><span class="n">gdf_from_place</span><span class="p">(</span><span class="n">pihlajamaki_q</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    ---------------------------------------------------------------------------</span>
<span class="go">timeout                                   Traceback (most recent call last)</span>
<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connection.py in _new_conn(self)</span>
<span class="go">    170             conn = connection.create_connection(</span>
<span class="go">--&gt; 171                 (self._dns_host, self.port), self.timeout, **extra_kw)</span>
<span class="go">    172 </span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/util/connection.py in create_connection(address, timeout, source_address, socket_options)</span>
<span class="go">     78     if err is not None:</span>
<span class="go">---&gt; 79         raise err</span>
<span class="go">     80 </span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/util/connection.py in create_connection(address, timeout, source_address, socket_options)</span>
<span class="go">     68                 sock.bind(source_address)</span>
<span class="go">---&gt; 69             sock.connect(sa)</span>
<span class="go">     70             return sock</span>

<span class="go">timeout: timed out</span>

<span class="go">During handling of the above exception, another exception occurred:</span>

<span class="go">ConnectTimeoutError                       Traceback (most recent call last)</span>
<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connectionpool.py in urlopen(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, **response_kw)</span>
<span class="go">    599                                                   body=body, headers=headers,</span>
<span class="go">--&gt; 600                                                   chunked=chunked)</span>
<span class="go">    601 </span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connectionpool.py in _make_request(self, conn, method, url, timeout, chunked, **httplib_request_kw)</span>
<span class="go">    342         try:</span>
<span class="go">--&gt; 343             self._validate_conn(conn)</span>
<span class="go">    344         except (SocketTimeout, BaseSSLError) as e:</span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connectionpool.py in _validate_conn(self, conn)</span>
<span class="go">    848         if not getattr(conn, &#39;sock&#39;, None):  # AppEngine might not have  `.sock`</span>
<span class="go">--&gt; 849             conn.connect()</span>
<span class="go">    850 </span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connection.py in connect(self)</span>
<span class="go">    313         # Add certificate verification</span>
<span class="go">--&gt; 314         conn = self._new_conn()</span>
<span class="go">    315 </span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connection.py in _new_conn(self)</span>
<span class="go">    175                 self, &quot;Connection to %s timed out. (connect timeout=%s)&quot; %</span>
<span class="go">--&gt; 176                 (self.host, self.timeout))</span>
<span class="go">    177 </span>

<span class="go">ConnectTimeoutError: (&lt;urllib3.connection.VerifiedHTTPSConnection object at 0x7efd9b7e0908&gt;, &#39;Connection to nominatim.openstreetmap.org timed out. (connect timeout=30)&#39;)</span>

<span class="go">During handling of the above exception, another exception occurred:</span>

<span class="go">MaxRetryError                             Traceback (most recent call last)</span>
<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/requests/adapters.py in send(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="go">    444                     retries=self.max_retries,</span>
<span class="go">--&gt; 445                     timeout=timeout</span>
<span class="go">    446                 )</span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/connectionpool.py in urlopen(self, method, url, body, headers, retries, redirect, assert_same_host, timeout, pool_timeout, release_conn, chunked, body_pos, **response_kw)</span>
<span class="go">    637             retries = retries.increment(method, url, error=e, _pool=self,</span>
<span class="go">--&gt; 638                                         _stacktrace=sys.exc_info()[2])</span>
<span class="go">    639             retries.sleep()</span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/urllib3/util/retry.py in increment(self, method, url, response, error, _pool, _stacktrace)</span>
<span class="go">    397         if new_retry.is_exhausted():</span>
<span class="go">--&gt; 398             raise MaxRetryError(_pool, url, error or ResponseError(cause))</span>
<span class="go">    399 </span>

<span class="go">MaxRetryError: HTTPSConnectionPool(host=&#39;nominatim.openstreetmap.org&#39;, port=443): Max retries exceeded with url: /search?format=json&amp;limit=1&amp;dedupe=0&amp;polygon_geojson=1&amp;q=Pihlajam%C3%A4ki%2C+Malmi%2C+Helsinki%2C+Finland (Caused by ConnectTimeoutError(&lt;urllib3.connection.VerifiedHTTPSConnection object at 0x7efd9b7e0908&gt;, &#39;Connection to nominatim.openstreetmap.org timed out. (connect timeout=30)&#39;))</span>

<span class="go">During handling of the above exception, another exception occurred:</span>

<span class="go">ConnectTimeout                            Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-11-b824c4dfb489&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 pihlajamaki = ox.gdf_from_place(pihlajamaki_q)</span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/osmnx/core.py in gdf_from_place(query, gdf_name, which_result, buffer_dist)</span>
<span class="go">    436 </span>
<span class="go">    437     # get the data from OSM</span>
<span class="go">--&gt; 438     data = osm_polygon_download(query, limit=which_result)</span>
<span class="go">    439     if len(data) &gt;= which_result:</span>
<span class="go">    440 </span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/osmnx/core.py in osm_polygon_download(query, limit, polygon_geojson)</span>
<span class="go">    404 </span>
<span class="go">    405     # request the URL, return the JSON</span>
<span class="go">--&gt; 406     response_json = nominatim_request(params=params, timeout=30)</span>
<span class="go">    407     return response_json</span>
<span class="go">    408 </span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/osmnx/core.py in nominatim_request(params, pause_duration, timeout, error_pause_duration)</span>
<span class="go">    260         start_time = time.time()</span>
<span class="go">    261         log(&#39;Requesting {} with timeout={}&#39;.format(prepared_url, timeout))</span>
<span class="go">--&gt; 262         response = requests.get(url, params=params, timeout=timeout, headers=get_http_headers())</span>
<span class="go">    263 </span>
<span class="go">    264         # get the response size and the domain, log result</span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/requests/api.py in get(url, params, **kwargs)</span>
<span class="go">     70 </span>
<span class="go">     71     kwargs.setdefault(&#39;allow_redirects&#39;, True)</span>
<span class="go">---&gt; 72     return request(&#39;get&#39;, url, params=params, **kwargs)</span>
<span class="go">     73 </span>
<span class="go">     74 </span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/requests/api.py in request(method, url, **kwargs)</span>
<span class="go">     56     # cases, and look like a memory leak in others.</span>
<span class="go">     57     with sessions.Session() as session:</span>
<span class="go">---&gt; 58         return session.request(method=method, url=url, **kwargs)</span>
<span class="go">     59 </span>
<span class="go">     60 </span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/requests/sessions.py in request(self, method, url, params, data, headers, cookies, files, auth, timeout, allow_redirects, proxies, hooks, stream, verify, cert, json)</span>
<span class="go">    510         }</span>
<span class="go">    511         send_kwargs.update(settings)</span>
<span class="go">--&gt; 512         resp = self.send(prep, **send_kwargs)</span>
<span class="go">    513 </span>
<span class="go">    514         return resp</span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/requests/sessions.py in send(self, request, **kwargs)</span>
<span class="go">    620 </span>
<span class="go">    621         # Send the request</span>
<span class="go">--&gt; 622         r = adapter.send(request, **kwargs)</span>
<span class="go">    623 </span>
<span class="go">    624         # Total elapsed time of the request (approximately)</span>

<span class="go">~/miniconda/envs/autogis-environment/lib/python3.5/site-packages/requests/adapters.py in send(self, request, stream, timeout, verify, cert, proxies)</span>
<span class="go">    499                 # TODO: Remove this in 3.0.0: see #2811</span>
<span class="go">    500                 if not isinstance(e.reason, NewConnectionError):</span>
<span class="go">--&gt; 501                     raise ConnectTimeout(e, request=request)</span>
<span class="go">    502 </span>
<span class="go">    503             if isinstance(e.reason, ResponseError):</span>

<span class="go">ConnectTimeout: HTTPSConnectionPool(host=&#39;nominatim.openstreetmap.org&#39;, port=443): Max retries exceeded with url: /search?format=json&amp;limit=1&amp;dedupe=0&amp;polygon_geojson=1&amp;q=Pihlajam%C3%A4ki%2C+Malmi%2C+Helsinki%2C+Finland (Caused by ConnectTimeoutError(&lt;urllib3.connection.VerifiedHTTPSConnection object at 0x7efd9b7e0908&gt;, &#39;Connection to nominatim.openstreetmap.org timed out. (connect timeout=30)&#39;))</span>
</pre></div>
</div>
<ul class="simple">
<li>Reproject the regions to same CRS as the DEM</li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [12]: </span><span class="n">kallio</span> <span class="o">=</span> <span class="n">kallio</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">dem</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-12-584f28a7c29c&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">kallio</span> <span class="o">=</span> <span class="n">kallio</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">dem</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;kallio&#39; is not defined

<span class="gp">In [13]: </span><span class="n">pihlajamaki</span> <span class="o">=</span> <span class="n">pihlajamaki</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">crs</span><span class="o">=</span><span class="n">dem</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-13-e816ce8415cb&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 pihlajamaki = pihlajamaki.to_crs(crs=dem.crs.data)</span>

<span class="go">NameError: name &#39;pihlajamaki&#39; is not defined</span>
</pre></div>
</div>
<ul class="simple">
<li>Plot the DEM and the regions on top of it</li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [14]: </span><span class="n">ax</span> <span class="o">=</span> <span class="n">show</span><span class="p">((</span><span class="n">dem</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-14-c18b56a9a19e&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">show</span><span class="p">((</span><span class="n">dem</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="ne">NameError</span>: name &#39;dem&#39; is not defined

<span class="gp">In [15]: </span><span class="n">kallio</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                        ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-15-6d653c3351f4&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 kallio.plot(ax=ax, facecolor=&#39;None&#39;, edgecolor=&#39;red&#39;, linewidth=2)</span>

<span class="go">NameError: name &#39;kallio&#39; is not defined</span>

<span class="gp">In [16]: </span><span class="n">pihlajamaki</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-16-5f5472ca3885&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 pihlajamaki.plot(ax=ax, facecolor=&#39;None&#39;, edgecolor=&#39;blue&#39;, linewidth=2)</span>

<span class="go">NameError: name &#39;pihlajamaki&#39; is not defined</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/zonal_stat_areas.png"><img alt="../../_images/zonal_stat_areas.png" src="../../_images/zonal_stat_areas.png" style="width: 450px;" /></a>
<p><strong>Which one is higher? Kallio or Pihlajamäki? We can use zonal statistics to find out!</strong></p>
<ul class="simple">
<li>First we need to get the values of the dem as numpy array and the affine of the raster</li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [17]: </span><span class="n">array</span> <span class="o">=</span> <span class="n">dem</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-17-804bc563da5e&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">array</span> <span class="o">=</span> <span class="n">dem</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;dem&#39; is not defined

<span class="gp">In [18]: </span><span class="n">affine</span> <span class="o">=</span> <span class="n">dem</span><span class="o">.</span><span class="n">affine</span>
<span class="go">                                                                                                                                                                                                                                                                        ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-18-c30dd96ac91b&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 affine = dem.affine</span>

<span class="go">NameError: name &#39;dem&#39; is not defined</span>
</pre></div>
</div>
<ul class="simple">
<li>Now we can calculate the zonal statistics by using the function <code class="docutils literal notranslate"><span class="pre">zonal_stats</span></code>.</li>
</ul>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">zs_kallio</span> <span class="o">=</span> <span class="n">zonal_stats</span><span class="p">(</span><span class="n">kallio</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="n">affine</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;majority&#39;</span><span class="p">])</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-19-4046cca6e209&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">zs_kallio</span> <span class="o">=</span> <span class="n">zonal_stats</span><span class="p">(</span><span class="n">kallio</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="n">affine</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;majority&#39;</span><span class="p">])</span>

<span class="ne">NameError</span>: name &#39;kallio&#39; is not defined

<span class="gp">In [20]: </span><span class="n">zs_pihla</span> <span class="o">=</span> <span class="n">zonal_stats</span><span class="p">(</span><span class="n">pihlajamaki</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="n">affine</span><span class="p">,</span> <span class="n">stats</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;majority&#39;</span><span class="p">])</span>
<span class="go">                                                                                                                                                                                                                                                                                                                                                                 ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-20-a91a334c1489&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 zs_pihla = zonal_stats(pihlajamaki, array, affine=affine, stats=[&#39;min&#39;, &#39;max&#39;, &#39;mean&#39;, &#39;median&#39;, &#39;majority&#39;])</span>

<span class="go">NameError: name &#39;pihlajamaki&#39; is not defined</span>
</pre></div>
</div>
<p>Okey. So what do we have now?</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="gp">In [21]: </span><span class="k">print</span><span class="p">(</span><span class="n">zs_kallio</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-21-29798306b288&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="k">print</span><span class="p">(</span><span class="n">zs_kallio</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;zs_kallio&#39; is not defined

<span class="gp">In [22]: </span><span class="k">print</span><span class="p">(</span><span class="n">zs_pihla</span><span class="p">)</span>
<span class="go">                                                                                                                                                                                                                                                                           ---------------------------------------------------------------------------</span>
<span class="go">NameError                                 Traceback (most recent call last)</span>
<span class="go">&lt;ipython-input-22-51d85c31f326&gt; in &lt;module&gt;()</span>
<span class="go">----&gt; 1 print(zs_pihla)</span>

<span class="go">NameError: name &#39;zs_pihla&#39; is not defined</span>
</pre></div>
</div>
<p>Super! Now we can see that <code class="docutils literal notranslate"><span class="pre">Pihlajamäki</span></code> seems to be slightly higher compared to <code class="docutils literal notranslate"><span class="pre">Kallio</span></code>.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../../notebooks/L5/raster-mosaic.html" class="btn btn-neutral" title="Creating a raster mosaic" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Henrikki Tenkanen
      Last updated on Nov 11, 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
    <p> <br/> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br /> </a></p>
     


</footer>

        </div>
      </div>

    </section>

  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
        <span class="fa fa-book"> Other Versions</span>
        v: master
        <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
        <dl>
            <dt>Branches</dt>
            <dd><a href="zonal-statistics.html">master</a></dd>
        </dl>
    </div>
</div>


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../../',
              VERSION:'CSC',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>